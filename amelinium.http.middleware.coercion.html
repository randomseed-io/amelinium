<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>amelinium.http.middleware.coercion documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script><link rel="stylesheet" type="text/css" href="css/randomseed.css" /></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Amelinium</span> <span class="project-version">1.0.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="10_introduction.html"><div class="inner"><span>Introduction</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><a href="amelinium.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>amelinium</span></div></a></li><li class="depth-2 branch"><a href="amelinium.api.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>api</span></div></a></li><li class="depth-2"><a href="amelinium.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3"><a href="amelinium.auth.specs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>specs</span></div></a></li><li class="depth-2"><a href="amelinium.common.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>common</span></div></a></li><li class="depth-3"><a href="amelinium.common.oplog.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>oplog</span></div></a></li><li class="depth-4"><a href="amelinium.common.oplog.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3 branch"><a href="amelinium.common.populators.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>populators</span></div></a></li><li class="depth-3"><a href="amelinium.common.swagger.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>swagger</span></div></a></li><li class="depth-2 branch"><a href="amelinium.core.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="amelinium.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>http</span></div></div></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></div></li><li class="depth-4"><a href="amelinium.http.client.twilio.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>twilio</span></div></a></li><li class="depth-3"><a href="amelinium.http.middleware.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-4 branch current"><a href="amelinium.http.middleware.coercion.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercion</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.content.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>content</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.debug.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>debug</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.format.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>format</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.headers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>headers</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.language.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>language</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.lazy-req.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>lazy-req</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.populators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>populators</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.remote-ip.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>remote-ip</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.roles.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>roles</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.middleware.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-4"><a href="amelinium.http.middleware.validators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>validators</span></div></a></li><li class="depth-3"><a href="amelinium.http.server.html"><div class="inner"><span class="tree" style="top: -424px;"><span class="top" style="height: 433px;"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-4 branch"><a href="amelinium.http.server.jetty.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jetty</span></div></a></li><li class="depth-4"><a href="amelinium.http.server.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="amelinium.i18n.html"><div class="inner"><span class="tree" style="top: -610px;"><span class="top" style="height: 619px;"></span><span class="bottom"></span></span><span>i18n</span></div></a></li><li class="depth-3"><a href="amelinium.i18n.pluralizers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pluralizers</span></div></a></li><li class="depth-2 branch"><a href="amelinium.locale.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>locale</span></div></a></li><li class="depth-2 branch"><a href="amelinium.logging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>logging</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></div></li><li class="depth-3 branch"><a href="amelinium.proto.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3"><a href="amelinium.proto.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-2 branch"><a href="amelinium.schemas.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>schemas</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></div></li><li class="depth-3"><a href="amelinium.server.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>types</span></div></div></li><li class="depth-3 branch"><a href="amelinium.types.auth.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>auth</span></div></a></li><li class="depth-3 branch"><a href="amelinium.types.db.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>db</span></div></a></li><li class="depth-3 branch"><a href="amelinium.types.errors.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>errors</span></div></a></li><li class="depth-3"><a href="amelinium.types.session.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>session</span></div></a></li><li class="depth-2"><a href="amelinium.web.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3"><a href="amelinium.web.taggers.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>taggers</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-default-exception-handler"><div class="inner"><span>default-exception-handler</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-explain-errors"><div class="inner"><span>explain-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-init-coercer"><div class="inner"><span>init-coercer</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-init-exceptions-handler"><div class="inner"><span>init-exceptions-handler</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-init-registry"><div class="inner"><span>init-registry</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-inject-errors"><div class="inner"><span>inject-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-join-errors"><div class="inner"><span>join-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-join-errors-with-values"><div class="inner"><span>join-errors-with-values</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-list-errors"><div class="inner"><span>list-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-map-errors"><div class="inner"><span>map-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-param-type"><div class="inner"><span>param-type</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-parse-errors"><div class="inner"><span>parse-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-recode-errors"><div class="inner"><span>recode-errors</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-split-error"><div class="inner"><span>split-error</span></div></a></li><li class="depth-1"><a href="amelinium.http.middleware.coercion.html#var-translate-error"><div class="inner"><span>translate-error</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">amelinium.http.middleware.coercion</h1><h4 class="added">added in 1.0.0</h4><div class="doc"><div class="markdown"><p>amelinium service, HTTP parameters coercion.</p>
</div></div><div class="public anchor" id="var-default-exception-handler"><h3>default-exception-handler</h3><div class="usage"><code>(default-exception-handler req e responder raiser)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-282">view source</a></div></div><div class="public anchor" id="var-explain-errors"><h3>explain-errors</h3><div class="usage"><code>(explain-errors data translate-sub)</code></div><div class="doc"><div class="markdown"><p>Like <code>recode-errors</code> but each error map contains the additional key <code>:parameter/message</code> containing a human-readable messages created with translation function <code>translate-sub</code>. Enriches the output map with <code>:parameter/name</code>, <code>:error/summary</code> and <code>:error/description</code> entries. To be used in API responses.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-132">view source</a></div></div><div class="public anchor" id="var-init-coercer"><h3>init-coercer</h3><div class="usage"><code>(init-coercer k {:keys [init initializer config enabled?], :or {enabled? true}})</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-331">view source</a></div></div><div class="public anchor" id="var-init-exceptions-handler"><h3>init-exceptions-handler</h3><div class="usage"><code>(init-exceptions-handler k {enabled? :enabled?, exception-handler :handler, responder :responder, raiser :raiser, :or {enabled? true, exception-handler default-exception-handler, responder identity, raiser (fn* [p1__52857#] (throw p1__52857#))}})</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-303">view source</a></div></div><div class="public anchor" id="var-init-registry"><h3>init-registry</h3><div class="usage"><code>(init-registry config)</code></div><div class="doc"><div class="markdown"></div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-295">view source</a></div></div><div class="public anchor" id="var-inject-errors"><h3>inject-errors</h3><div class="usage"><code>(inject-errors req errors)</code></div><div class="doc"><div class="markdown"><p>Takes coercion errors, parses them, and injects into a <code>req</code> under a key named <code>:form/errors</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-274">view source</a></div></div><div class="public anchor" id="var-join-errors"><h3>join-errors</h3><div class="usage"><code>(join-errors errors)</code></div><div class="doc"><div class="markdown"><p>Used to produce a string containing parameter names and their types (as defined in schema) from a coercion errors simple map or coercion errors sequence (produced by <code>list-errors</code> or <code>map-errors</code> respectively). For anon-empty string it simply returns it. Used to generate a query string containing form errors in a form of <code>parameter-id</code> or <code>parameter-id:parameter-type</code> separated by commas. The whole string can then be encoded and used as a query parameter <code>:form-errors</code> when redirecting anonymous user to a page with a previous form which needs to be corrected.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-162">view source</a></div></div><div class="public anchor" id="var-join-errors-with-values"><h3>join-errors-with-values</h3><div class="usage"><code>(join-errors-with-values errors)</code></div><div class="doc"><div class="markdown"><p>Used to produce a string containing parameter names and their types (as defined in schema) from a coercion errors simple map or coercion errors sequence (produced by <code>list-errors</code> or <code>map-errors</code> respectively). For anon-empty string it simply returns it. Used to generate a query string containing form errors in a form of <code>parameter-id</code> or <code>parameter-id:parameter-type:parameter-value</code> separated by commas. The whole string can then be encoded and used as a query parameter <code>:form-errors</code> when redirecting anonymous user to a page with a previous form which needs to be corrected. Be aware that it might be hard to parse the output string if a value contains a comma character.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-183">view source</a></div></div><div class="public anchor" id="var-list-errors"><h3>list-errors</h3><div class="usage"><code>(list-errors data)</code></div><div class="doc"><div class="markdown"><p>Returns a sequence of coercion errors containing 3-element sequences. First element of each being a parameter identifier, second element being a parameter type described by schema (if detected), and third being its current value. Takes an exception data map which should contain the <code>:coercion</code> key. Used, among other applications, to expose form errors to another page which should indicate them to a visitor.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-141">view source</a></div></div><div class="public anchor" id="var-map-errors"><h3>map-errors</h3><div class="usage"><code>(map-errors data)</code></div><div class="doc"><div class="markdown"><p>Like <code>list-errors</code> but returns a map in which keys are parameter names and values are parameter types (as defined in a schema used to validate and coerce them). Used to pass form errors to another page which should expose them to a visitor.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-154">view source</a></div></div><div class="public anchor" id="var-param-type"><h3>param-type</h3><div class="usage"><code>(param-type e)</code></div><div class="doc"><div class="markdown"><p>Takes a coercion error expressed as a map <code>e</code> and returns a string with parameter type if the type can easily be obtained (is a simple name expressed as a string or a string representation of keyword). For complex schemas it returns <code>nil</code>.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-28">view source</a></div></div><div class="public anchor" id="var-parse-errors"><h3>parse-errors</h3><div class="usage"><code>(parse-errors errors)</code></div><div class="doc"><div class="markdown"><p>Transforms a string previously exposed with <code>join-errors</code>, a list created with <code>list-errors</code> or a map resulted from calling <code>map-errors</code>, into a map containing parameter names as keys and parameter types as values.</p>
<p>Used to parse input from a query string or saved session variable when visiting a page with a previously visited form which is to be corrected (after redirecting to it).</p>
<p>The <code>explain-form-error</code> template tag can make use of such map to decide whether an input field had invalid data.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-245">view source</a></div></div><div class="public anchor" id="var-recode-errors"><h3>recode-errors</h3><div class="usage"><code>(recode-errors data)</code></div><div class="doc"><div class="markdown"><p>Uses exception data to recode coercion errors in a form of a map. To be used mainly with API handlers. For web form error reporting <code>map-errors</code>, <code>list-errors</code> and <code>explain-errors</code> are better suited.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-106">view source</a></div></div><div class="public anchor" id="var-split-error"><h3>split-error</h3><div class="usage"><code>(split-error param-id param-type param-value)</code><code>(split-error param-id param-type)</code><code>(split-error param-id)</code></div><div class="doc"><div class="markdown"><p>Takes <code>param-id</code> and optional <code>param-type</code> and tries to clean-up their string representations to produce a 3-element vector. When only 1 argument is present or when the second argument is <code>nil</code> or empty, it will try to parse the first argument so if it contains a colon character it will be split into three parts: parameter ID, parameter type and value. Used as a helper by <code>parse-errors</code> and by argument parsers in template tags.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-205">view source</a></div></div><div class="public anchor" id="var-translate-error"><h3>translate-error</h3><div class="usage"><code>(translate-error req param-error-properties req param-id param-type req lang param-id param-type translate-sub param-error-properties translate-sub param-id param-type)</code></div><div class="doc"><div class="markdown"><p>Takes a translation function with already applied language ID or a request map, parameter ID and parameter type and tries to find the best translations describing the erroneous field. Returns a map with the following keys <code>:parameter/name</code>, <code>:error/summary</code> and <code>:error/description</code>. To be used after receiving form errors data after a redirect.</p>
</div></div><div class="src-link"><a href="https://github.com/randomseed-io/amelinium/utils/tree/1.0.0/src/amelinium/http/middleware/coercion.clj#lines-37">view source</a></div></div></div></body></html>